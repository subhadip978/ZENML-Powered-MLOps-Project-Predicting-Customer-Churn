import{r as x,j as e}from"./@radix-BXWm7HOa.js";import{k as w,l as S,j as N,F as v,a0 as O,a1 as P,h,a2 as A,a3 as q,a4 as V,f as B,I as y,a7 as I,a8 as L,a9 as G,n as E,af as H,ag as U,ah as W,ai as J,z as g,aj as X,D as Y,S as T,B as Z}from"./index-DhIZtpxB.js";import{S as ee,P as se}from"./SearchField-C9R0mdaX.js";import{S as te,s as ae,E as re}from"./EditSecretDialog-Bd7mFLS4.js";import{S as ne}from"./plus-FB9-lEq_.js";import{S as K}from"./trash-Cd5CSFqA.js";import{b as R,c as _,a as M}from"./@tanstack-FmcYZMuX.js";import{t as ie}from"./zod-CnykDKJj.js";import{u as oe,a as le,C as k}from"./index.esm-DT4uyn2i.js";import{o as ce}from"./url-hcMJkz8p.js";import{D as de}from"./DisplayDate-DizbSeT-.js";import{I as me}from"./InlineAvatar-DpTLgM3Q.js";import{S as ue}from"./edit-C0MVvPD2.js";import{S as xe}from"./dots-horizontal-sKQlWEni.js";import{A as F}from"./AlertDialogDropdownItem-ErO9aOgK.js";import{S as he}from"./Lock-CNyJvf2r.js";import{C as pe}from"./CopyButton-Dbo52T1K.js";import{c as fe,b as je}from"./@react-router-l3lMcXA2.js";import"./@reactflow-CeVxyqYT.js";import"./chevron-right-double-Dk8e2L99.js";import"./index-Bd1xgUQG.js";import"./copy-f3XGPPxt.js";async function ge(a){const t=w(S.secrets.add(a.workspace)),s=await N(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const r=await s.json().then(n=>n.detail).catch(()=>"Failed to create Secret");throw new v({status:s.status,statusText:s.statusText,message:r})}return s.json()}function ye(a){return R({mutationFn:async t=>ge(t),...a})}function we({id:a,workspace:t}){const[s,r]=x.useState(!1);return e.jsxs(O,{open:s,onOpenChange:n=>{r(n)},children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{className:"shrink-0",intent:"primary",children:"Add secret"})}),e.jsxs(A,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(q,{children:e.jsx(V,{children:"Register New Secret"})}),e.jsx(Se,{userId:a,setOpen:r,workspaceId:t.id})]})]})}function Se({userId:a,setOpen:t,workspaceId:s}){const{handleSubmit:r,control:n,watch:i,setValue:c,formState:{isValid:u},reset:p}=oe({resolver:ie(ae),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:d,append:j,remove:D}=le({control:n,name:"keysValues"}),{toast:C}=B(),f=_(),{mutate:$}=ye({onError(o){G(o)&&C({status:"error",emphasis:"subtle",description:o.message,rounded:!0})},onSuccess(){f.invalidateQueries({queryKey:["secrets"]}),t(!1),p()}}),z=o=>{$({user:a,workspace:s,name:o.secretName,scope:"workspace",values:o.keysValues.reduce((l,m)=>(m.key&&m.value&&(l[m.key]=m.value),l),{})})},Q=o=>{z(o)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:r(Q),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(k,{name:"secretName",control:n,render:({field:o})=>e.jsx(y,{...o,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold ",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row ",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),d.map((o,l)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1 ",children:[e.jsx("div",{className:"relative flex-grow ",children:e.jsx(k,{name:`keysValues.${l}.key`,control:n,render:({field:m})=>e.jsx(y,{...m,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(k,{name:`keysValues.${l}.value`,control:n,render:({field:m})=>e.jsx(y,{...m,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:i(`keysValues.${l}.showPassword`)?"text":"password"})}),e.jsx("div",{onClick:()=>{const m=i(`keysValues.${l}.showPassword`);c(`keysValues.${l}.showPassword`,!m)},className:"absolute inset-y-1 right-0 flex cursor-pointer items-center pb-1 pr-3",children:e.jsx(te,{className:"h-4 w-4 flex-shrink-0 cursor-pointer"})})]})}),e.jsxs("div",{className:"flex items-center",children:[l===d.length-1&&e.jsx(h,{intent:"primary",emphasis:"subtle",onClick:()=>j({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(ne,{className:"flex-shrink-0 fill-primary-600"})}),l!==d.length-1&&e.jsx(h,{intent:"secondary",emphasis:"minimal",onClick:()=>D(l),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(K,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},o.id))]})}),e.jsxs(I,{className:"gap-[10px]",children:[e.jsx(L,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"primary",disabled:!u,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function Ne({params:a}){return["secrets",a]}async function ve({params:a}){const t=w(S.secrets.all+"?"+ce(a)),s=await N(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&E(),!s.ok)throw new v({message:"Error while fetching secrets",status:s.status,statusText:s.statusText});return s.json()}function De(a,t){return M({queryKey:Ne(a),queryFn:()=>ve(a),...t})}async function Ce(a){const t=w(S.secrets.detail(a)),s=await N(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(s.status===404&&E(),!s.ok)throw new v({message:"Error deleting secret",status:s.status,statusText:s.statusText});return s.json()}function ke(a){return R({mutationFn:async t=>Ce(t),...a})}function be({secretId:a,isOpen:t,onClose:s}){const r=_(),{mutate:n}=ke({onSuccess(){r.invalidateQueries({queryKey:["secrets"]})}}),[i,c]=x.useState("");function u(){n(a)}function p(d){c(d.target.value)}return e.jsxs(O,{open:t,onOpenChange:s,children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{className:"shrink-0",intent:"primary",children:"Delete Secret"})}),e.jsxs(A,{children:[e.jsx(q,{children:e.jsx(V,{children:"Delete secret"})}),e.jsxs("div",{className:"gap-5 p-5",children:[e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"Are you sure you want to delete this secret?"}),e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"This action cannot be undone."}),e.jsx("h3",{className:"font-inter text-sm mb-1 mt-4 text-left font-medium leading-5",children:"Please type DELETE to confirm"}),e.jsx(y,{name:"key",onChange:p,className:"w-full",required:!0,value:i})]}),e.jsxs(I,{className:"gap-[10px]",children:[e.jsx(L,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"danger",type:"submit",form:"edit-secret-form",onClick:u,disabled:i!=="DELETE",children:"Delete"})]})]})]})}function Ee({secretId:a}){const[t,s]=x.useState(!1),[r]=x.useState(!1),[n,i]=x.useState(!1),[c,u]=x.useState(!1),p=x.useRef(null),d=x.useRef(null);function j(){d.current=p.current}function D(){u(!0)}function C(f){i(f)}return e.jsxs(H,{onOpenChange:s,open:t,children:[e.jsx(U,{ref:p,children:e.jsx(xe,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsxs(W,{hidden:r,onCloseAutoFocus:f=>{d.current&&(d.current.focus(),d.current=null,f.preventDefault())},align:"end",sideOffset:7,children:[e.jsx(F,{onSelect:j,onOpenChange:C,triggerChildren:"Edit ",icon:e.jsx(ue,{}),children:e.jsx(re,{secretId:a,isOpen:n,onClose:()=>{s(!1),i(!1)},isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsx(F,{onSelect:j,onOpenChange:D,triggerChildren:"Delete ",icon:e.jsx(K,{}),children:e.jsx(be,{isOpen:c,onClose:()=>{s(!1),u(!1)},secretId:a})})]})]})}function Te(a){return[{id:"secret",header:"Secret",accessorFn:t=>t.name,cell:({getValue:t,row:s})=>e.jsxs("div",{className:"flex cursor-pointer items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 flex-shrink-0 cursor-pointer fill-primary-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"group/copybutton flex flex flex-row items-center gap-0.5 space-x-1",children:[e.jsx("span",{className:" text-text-md font-semibold text-theme-text-primary",onClick:()=>a(`/settings/secrets/${s.original.id}`),children:t()}),e.jsx(pe,{copyText:t()})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[" ",s.original.id.slice(0,8)]})]})]})},{id:"author",header:"Author",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.user},cell:({getValue:t})=>{const s=t();return e.jsx(e.Fragment,{children:e.jsx(me,{username:J(s)})})}},{id:"created_at",header:"Created At",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(de,{dateString:t()})})},{id:"admin_actions",header:"",accessorFn:t=>String(t.id),cell:({row:t,getValue:s})=>{var n,i,c;const r=s();return(c=(i=(n=t.original.body)==null?void 0:n.user)==null?void 0:i.body)!=null&&c.is_admin?e.jsx(Ee,{secretId:r}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}]}async function Fe(a){const t=w(S.workspaces.detail(a)),s=await N(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&E(),!s.ok)throw new v({message:"Error fetching secret details",status:s.status,statusText:s.statusText});return s.json()}function Oe(a,t){return M({queryFn:()=>Fe(a),queryKey:["workspaceDetail",a],...t})}const b=1,Pe=g.object({page:g.coerce.number().min(b).optional().default(b).catch(b),name:g.string().optional(),operator:g.enum(["and","or"]).optional()});function Ae(){const[a]=fe(),{page:t,name:s,operator:r}=Pe.parse({page:a.get("page")||void 0,name:a.get("name")||void 0,operator:a.get("operator")||void 0});return{page:t,name:s,logical_operator:r}}function qe(){const a=je(),t=Ae(),{data:s}=De({params:{...t,sort_by:"desc:created"}},{throwOnError:!0}),{data:r}=X(),n=(r==null?void 0:r.id)||"",{data:i,isLoading:c,isError:u}=Oe("default");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(ee,{searchParams:t}),c?e.jsx("div",{children:"Loading..."}):u?e.jsx("div",{children:"Error loading workspace details."}):e.jsx(we,{id:n,workspace:i})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(Y,{columns:Te(a),data:s.items}):e.jsx(T,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(se,{searchParams:t,paginate:s}):e.jsx(T,{className:"h-[36px] w-[300px]"})]})]})}function as(){return e.jsxs(Z,{className:"space-y-4 p-5",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("p",{className:"text-text-md text-theme-text-secondary",children:"Configure and manage your pipeline secrets and configurations."}),e.jsx("a",{href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"text-text-md  text-primary-400",children:"Learn More"})]}),e.jsx(qe,{})]})}export{as as default};
