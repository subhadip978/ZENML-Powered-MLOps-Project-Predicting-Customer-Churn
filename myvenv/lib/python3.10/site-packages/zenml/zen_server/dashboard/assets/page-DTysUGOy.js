import{r as l,j as e}from"./@radix-BXWm7HOa.js";import{u as m,S as v,a as w,b as j}from"./SuccessStep-DlkItqYG.js";import{A as y,P as A,a as P}from"./AwarenessChannel-CLXo5rKM.js";import{S as b}from"./SetPassword-52sNxNiO.js";import{j as U,F as _,k as g,l as F,e as C,f as E,i as k}from"./index-DhIZtpxB.js";import{b as N}from"./@tanstack-FmcYZMuX.js";import{u as M}from"./login-mutation-13A_JSVA.js";import{c as D}from"./@react-router-l3lMcXA2.js";import{E as H}from"./EmptyState-BHblM39I.js";import"./UpdatePasswordSchemas-oN4G3sKz.js";import"./check-circle-1_I207rW.js";import"./url-hcMJkz8p.js";import"./zod-CnykDKJj.js";import"./index.esm-DT4uyn2i.js";import"./file-text-B9JibxTs.js";import"./play-circle-XSkLR12B.js";import"./PasswordChecker-yGGoJSB-.js";import"./@reactflow-CeVxyqYT.js";const f=l.createContext(null);function T({children:t,initialUser:r}){const[n,s]=l.useState(r||{});return e.jsx(f.Provider,{value:{newUser:n,setNewUser:s},children:t})}function d(){const t=l.useContext(f);if(t===null)throw new Error("useActivationContext must be used within an ActivationProvider");return t}function I(){const{setSurveyStep:t}=m(),{setNewUser:r,newUser:n}=d();function s({fullName:a,getUpdates:o,email:i}){r(c=>({...c,...i?{email:i}:{email:null},full_name:a,email_opted_in:o})),t(c=>c+1)}return e.jsx(y,{email:n.email,fullName:n.full_name,submitHandler:s})}function L(){const{setSurveyStep:t}=m(),{setNewUser:r}=d();function n({newPassword:s}){r(a=>({...a,password:s})),t(a=>a+1)}return e.jsx(b,{submitHandler:n})}function z(){const{setSurveyStep:t}=m(),{setNewUser:r}=d();function n({amountProductionModels:s,primaryUse:a}){const o={primary_use:a,models_production:s};r(i=>({...i,user_metadata:{...i.user_metadata,...o}})),t(i=>i+1)}return e.jsx(A,{submitHandler:n})}async function J({userId:t,body:r}){const n=g(F.users.activate(t)),s=await U(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const a=await s.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>"Failed to update activate user");throw new _({status:s.status,statusText:s.statusText,message:a})}return s.json()}function O(t){return N({mutationFn:async r=>J(r),...t})}function R({userId:t,setUsername:r}){const{newUser:n}=d(),{setAuthState:s}=C(),{setSurveyStep:a}=m(),{mutate:o}=M({onSuccess:()=>{s("true"),a(u=>u+1)}}),{toast:i}=E(),{mutate:c}=O({onSuccess:async u=>{r(u.name),o({username:u.name,password:n.password??void 0})},onError:u=>{u instanceof Error&&i({status:"error",emphasis:"subtle",icon:e.jsx(k,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:u.message,rounded:!0})}});function S({other:u,channels:p,otherVal:x}){const h={awareness_channels:u?[...p,x]:p};c({userId:t,body:{...n,user_metadata:{...n.user_metadata,...h}}})}return e.jsx(P,{submitHandler:S})}function W(){const{surveyStep:t}=m(),[r]=D(),[n,s]=l.useState(""),a=r.get("user"),o=r.get("token");return!a||!o?e.jsx(H,{children:e.jsx("p",{children:"Invalid activation link."})}):e.jsx(e.Fragment,{children:e.jsxs(T,{initialUser:{activation_token:o},children:[e.jsx(v,{stepAmount:4}),t===1&&e.jsx(I,{}),t===2&&e.jsx(L,{}),t===3&&e.jsx(z,{}),t===4&&e.jsx(R,{setUsername:s,userId:a}),t===5&&e.jsx(w,{subHeader:"Your created your ZenML account",username:n})]})})}function ct(){return e.jsx("div",{children:e.jsx(j,{children:e.jsx(W,{})})})}export{ct as default};
