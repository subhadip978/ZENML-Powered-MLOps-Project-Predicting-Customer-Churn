import{r as _,j as t}from"./@radix-BXWm7HOa.js";import{b as Xe,u as P,C as M,S as et,a as ce,P as le,W as tt,L as rt}from"./ProviderRadio-BBqkIuTd.js";import{B as st,z as h,k as Y,l as J,j as ve,n as Ee,F as X,S as ee,I as B,h as w,am as nt,an as ot,ao as it,ap as at,aF as ct,aq as lt,a6 as ut,a0 as dt,a2 as ft,a4 as mt,d as ht,y as xt,f as Me,i as pt,r as yt,A as jt,b as gt,Y as _t}from"./index-DhIZtpxB.js";import{t as $}from"./zod-CnykDKJj.js";import{b as y,C as b,u as W,F as V,a as vt}from"./index.esm-DT4uyn2i.js";import{C as Se,a as St,S as bt,s as Re}from"./sharedSchema-BoYx_B_L.js";import{R as K,a as H}from"./RadioItem-xLhXoiFV.js";import{q as Le,a as te,b as qe,j as Be,c as Ct}from"./@tanstack-FmcYZMuX.js";import{o as wt,s as Nt}from"./url-hcMJkz8p.js";import{S as Ft}from"./Lock-CNyJvf2r.js";import{S as kt}from"./plus-FB9-lEq_.js";import{S as Pt}from"./trash-Cd5CSFqA.js";import{S as At}from"./dots-horizontal-sKQlWEni.js";import{T as be}from"./Tick-uxv80Q6a.js";import{C as zt}from"./persist-3-5nOJ6m.js";import{e as Ot}from"./components-Br2ezRib.js";import{L as Tt}from"./@react-router-l3lMcXA2.js";import"./aws-0_3UsPif.js";import"./@reactflow-CeVxyqYT.js";import"./stack-detail-query-B-US_-wa.js";import"./database-cXYNX9tt.js";import"./layout-D6oiSbfd.js";const $e=_.createContext(null);function It({children:e}){const[r,s]=_.useState({stackName:null,createdStackId:null,connectorConfig:null,fullstackResources:null,artifactStoreConfig:null,registryConfig:null,orchestratorConfig:null});return t.jsx($e.Provider,{value:{data:r,setData:s},children:e})}function C(){const e=_.useContext($e);if(e===null)throw new Error("useExistingInfraContext must be used within an ExistingInfraProvider");return e}const We=_.createContext(null);function ke({children:e,initialSchema:r}){const[s,n]=_.useState(r);return t.jsx(We.Provider,{value:{schema:s,setSchema:n},children:e})}function re(){const e=_.useContext(We);if(!e)throw new Error("useSchemaContext must be used within a SchemaProvider");return e}function T({children:e}){return t.jsx(st,{className:"w-full",children:e})}function I({children:e}){return t.jsx("div",{className:"border-b border-theme-border-moderate px-5 py-3 text-display-xs font-semibold",children:e})}function D({children:e}){return t.jsx("div",{className:"p-5",children:e})}function Dt({children:e}){return t.jsx("div",{className:"flex items-center justify-end gap-2 border-t border-theme-border-moderate p-5",children:e})}function E({children:e,displayCancel:r=!0}){return t.jsxs(Dt,{children:[r&&t.jsx(Xe,{}),e]})}const Et=h.object({resourceId:h.string().min(1),flavor:h.string()});function Mt(){return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(Se,{type:"artifact_store",className:"h-5 w-5 fill-primary-400"}),"Select your Artifact Store"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Choose one of the storages for the new Artifact Store."})]})}var Ve=Symbol.for("immer-nothing"),Pe=Symbol.for("immer-draftable"),j=Symbol.for("immer-state");function v(e,...r){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var A=Object.getPrototypeOf;function z(e){return!!e&&!!e[j]}function F(e){var r;return e?Ze(e)||Array.isArray(e)||!!e[Pe]||!!((r=e.constructor)!=null&&r[Pe])||ne(e)||oe(e):!1}var Rt=Object.prototype.constructor.toString();function Ze(e){if(!e||typeof e!="object")return!1;const r=A(e);if(r===null)return!0;const s=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return s===Object?!0:typeof s=="function"&&Function.toString.call(s)===Rt}function U(e,r){se(e)===0?Reflect.ownKeys(e).forEach(s=>{r(s,e[s],e)}):e.forEach((s,n)=>r(n,s,e))}function se(e){const r=e[j];return r?r.type_:Array.isArray(e)?1:ne(e)?2:oe(e)?3:0}function he(e,r){return se(e)===2?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function Ke(e,r,s){const n=se(e);n===2?e.set(r,s):n===3?e.add(s):e[r]=s}function Lt(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}function ne(e){return e instanceof Map}function oe(e){return e instanceof Set}function N(e){return e.copy_||e.base_}function xe(e,r){if(ne(e))return new Map(e);if(oe(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const s=Ze(e);if(r===!0||r==="class_only"&&!s){const n=Object.getOwnPropertyDescriptors(e);delete n[j];let o=Reflect.ownKeys(n);for(let i=0;i<o.length;i++){const a=o[i],u=n[a];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[a]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[a]})}return Object.create(A(e),n)}else{const n=A(e);if(n!==null&&s)return{...e};const o=Object.create(n);return Object.assign(o,e)}}function Ce(e,r=!1){return ie(e)||z(e)||!F(e)||(se(e)>1&&(e.set=e.add=e.clear=e.delete=qt),Object.freeze(e),r&&Object.entries(e).forEach(([s,n])=>Ce(n,!0))),e}function qt(){v(2)}function ie(e){return Object.isFrozen(e)}var Bt={};function k(e){const r=Bt[e];return r||v(0,e),r}var R;function He(){return R}function $t(e,r){return{drafts_:[],parent_:e,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ae(e,r){r&&(k("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=r)}function pe(e){ye(e),e.drafts_.forEach(Wt),e.drafts_=null}function ye(e){e===R&&(R=e.parent_)}function ze(e){return R=$t(R,e)}function Wt(e){const r=e[j];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function Oe(e,r){r.unfinalizedDrafts_=r.drafts_.length;const s=r.drafts_[0];return e!==void 0&&e!==s?(s[j].modified_&&(pe(r),v(4)),F(e)&&(e=Q(r,e),r.parent_||G(r,e)),r.patches_&&k("Patches").generateReplacementPatches_(s[j].base_,e,r.patches_,r.inversePatches_)):e=Q(r,s,[]),pe(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),e!==Ve?e:void 0}function Q(e,r,s){if(ie(r))return r;const n=r[j];if(!n)return U(r,(o,i)=>Te(e,n,r,o,i,s)),r;if(n.scope_!==e)return r;if(!n.modified_)return G(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const o=n.copy_;let i=o,a=!1;n.type_===3&&(i=new Set(o),o.clear(),a=!0),U(i,(u,f)=>Te(e,n,o,u,f,s,a)),G(e,o,!1),s&&e.patches_&&k("Patches").generatePatches_(n,s,e.patches_,e.inversePatches_)}return n.copy_}function Te(e,r,s,n,o,i,a){if(z(o)){const u=i&&r&&r.type_!==3&&!he(r.assigned_,n)?i.concat(n):void 0,f=Q(e,o,u);if(Ke(s,n,f),z(f))e.canAutoFreeze_=!1;else return}else a&&s.add(o);if(F(o)&&!ie(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Q(e,o),(!r||!r.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(s,n)&&G(e,o)}}function G(e,r,s=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Ce(r,s)}function Vt(e,r){const s=Array.isArray(e),n={type_:s?1:0,scope_:r?r.scope_:He(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=n,i=we;s&&(o=[n],i=L);const{revoke:a,proxy:u}=Proxy.revocable(o,i);return n.draft_=u,n.revoke_=a,u}var we={get(e,r){if(r===j)return e;const s=N(e);if(!he(s,r))return Zt(e,s,r);const n=s[r];return e.finalized_||!F(n)?n:n===ue(e.base_,r)?(de(e),e.copy_[r]=ge(n,e)):n},has(e,r){return r in N(e)},ownKeys(e){return Reflect.ownKeys(N(e))},set(e,r,s){const n=Ue(N(e),r);if(n!=null&&n.set)return n.set.call(e.draft_,s),!0;if(!e.modified_){const o=ue(N(e),r),i=o==null?void 0:o[j];if(i&&i.base_===s)return e.copy_[r]=s,e.assigned_[r]=!1,!0;if(Lt(s,o)&&(s!==void 0||he(e.base_,r)))return!0;de(e),je(e)}return e.copy_[r]===s&&(s!==void 0||r in e.copy_)||Number.isNaN(s)&&Number.isNaN(e.copy_[r])||(e.copy_[r]=s,e.assigned_[r]=!0),!0},deleteProperty(e,r){return ue(e.base_,r)!==void 0||r in e.base_?(e.assigned_[r]=!1,de(e),je(e)):delete e.assigned_[r],e.copy_&&delete e.copy_[r],!0},getOwnPropertyDescriptor(e,r){const s=N(e),n=Reflect.getOwnPropertyDescriptor(s,r);return n&&{writable:!0,configurable:e.type_!==1||r!=="length",enumerable:n.enumerable,value:s[r]}},defineProperty(){v(11)},getPrototypeOf(e){return A(e.base_)},setPrototypeOf(){v(12)}},L={};U(we,(e,r)=>{L[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}});L.deleteProperty=function(e,r){return L.set.call(this,e,r,void 0)};L.set=function(e,r,s){return we.set.call(this,e[0],r,s,e[0])};function ue(e,r){const s=e[j];return(s?N(s):e)[r]}function Zt(e,r,s){var o;const n=Ue(r,s);return n?"value"in n?n.value:(o=n.get)==null?void 0:o.call(e.draft_):void 0}function Ue(e,r){if(!(r in e))return;let s=A(e);for(;s;){const n=Object.getOwnPropertyDescriptor(s,r);if(n)return n;s=A(s)}}function je(e){e.modified_||(e.modified_=!0,e.parent_&&je(e.parent_))}function de(e){e.copy_||(e.copy_=xe(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Kt=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,s,n)=>{if(typeof r=="function"&&typeof s!="function"){const i=s;s=r;const a=this;return function(f=i,...d){return a.produce(f,c=>s.call(this,c,...d))}}typeof s!="function"&&v(6),n!==void 0&&typeof n!="function"&&v(7);let o;if(F(r)){const i=ze(this),a=ge(r,void 0);let u=!0;try{o=s(a),u=!1}finally{u?pe(i):ye(i)}return Ae(i,n),Oe(o,i)}else if(!r||typeof r!="object"){if(o=s(r),o===void 0&&(o=r),o===Ve&&(o=void 0),this.autoFreeze_&&Ce(o,!0),n){const i=[],a=[];k("Patches").generateReplacementPatches_(r,o,i,a),n(i,a)}return o}else v(1,r)},this.produceWithPatches=(r,s)=>{if(typeof r=="function")return(a,...u)=>this.produceWithPatches(a,f=>r(f,...u));let n,o;return[this.produce(r,s,(a,u)=>{n=a,o=u}),n,o]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){F(e)||v(8),z(e)&&(e=Ht(e));const r=ze(this),s=ge(e,void 0);return s[j].isManual_=!0,ye(r),s}finishDraft(e,r){const s=e&&e[j];(!s||!s.isManual_)&&v(9);const{scope_:n}=s;return Ae(n,r),Oe(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,r){let s;for(s=r.length-1;s>=0;s--){const o=r[s];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}s>-1&&(r=r.slice(s+1));const n=k("Patches").applyPatches_;return z(e)?n(e,r):this.produce(e,o=>n(o,r))}};function ge(e,r){const s=ne(e)?k("MapSet").proxyMap_(e,r):oe(e)?k("MapSet").proxySet_(e,r):Vt(e,r);return(r?r.scope_:He()).drafts_.push(s),s}function Ht(e){return z(e)||v(10,e),Qe(e)}function Qe(e){if(!F(e)||ie(e))return e;const r=e[j];let s;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,s=xe(e,r.scope_.immer_.useStrictShallowCopy_)}else s=xe(e,!0);return U(s,(n,o)=>{Ke(s,n,Qe(o))}),r&&(r.finalized_=!1),s}var g=new Kt,O=g.produce;g.produceWithPatches.bind(g);g.setAutoFreeze.bind(g);g.setUseStrictShallowCopy.bind(g);g.applyPatches.bind(g);g.createDraft.bind(g);g.finishDraft.bind(g);function Ut(){const{data:e,setData:r}=C(),{setCurrentStep:s}=P();if(!e.fullstackResources)return s(2),{handleFormSubmit:()=>{},flattenedInstances:[]};const n=e.fullstackResources.components_resources_info.artifact_store,o=n.flatMap(a=>a.accessible_by_service_connector.map(u=>({...a,value:u})));function i({flavor:a,resourceId:u}){const f=n.find(d=>d.flavor===a);f&&(r(d=>O(d,c=>{c.artifactStoreConfig={flavor:a,configuration:Object.fromEntries(Object.keys(f.required_configuration||{}).map(m=>[m,u])),service_connector_resource_id:u}})),s(d=>d+1))}return{handleFormSubmit:i,flattenedInstances:o}}async function Qt(e){const r=Y(J.flavors.all)+(e?`?${wt(e)}`:""),s=await ve(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&Ee(),!s.ok){const n=await s.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>"Error while fetching flavors");throw new X({status:s.status,statusText:s.statusText,message:n})}return s.json()}const Ge={all:["flavors"],flavorList:e=>Le({queryKey:[...Ge.all,e],queryFn:async()=>Qt(e)})};function q({flavor:e,type:r,width:s=32,height:n=32,...o}){var a;const i=te({...Ge.flavorList({name:e,type:r})});return i.isError?null:i.isPending?t.jsx(ee,{style:{height:`${n}px`,width:`${s}px`}}):t.jsx("img",{width:s,height:n,alt:`${e} logo`,...o,src:Nt(((a=i.data.items[0].body)==null?void 0:a.logo_url)??"")})}const Gt="artifact_store";function Yt(){const[e,r]=_.useState(""),{control:s,setValue:n,handleSubmit:o,register:i,watch:a,trigger:u,reset:f}=y(),{flattenedInstances:d,handleFormSubmit:c}=Ut(),m=d.filter(l=>l.value.toLocaleLowerCase().includes(e.toLocaleLowerCase()));return t.jsxs(t.Fragment,{children:[t.jsx(B,{placeholder:"Search...",onChange:l=>{f(),r(l.target.value)}}),t.jsxs("form",{onSubmit:o(c),id:"artifact-store-form",children:[t.jsx("input",{type:"hidden",...i("flavor")}),t.jsx("ul",{className:"space-y-1",children:m.map(l=>t.jsx("li",{children:t.jsx(b,{name:"resourceId",control:s,render:({field:{onChange:x,...p}})=>t.jsxs(K,{"data-state":a("resourceId")===l.value?"selected":"unselected",htmlFor:l.value,children:[t.jsx(H,{id:l.value,type:"radio",...p,onChange:S=>{n("flavor",l.flavor,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),x(S.target.value),u()},value:l.value,name:"connector-radio"}),t.jsx(q,{type:Gt,width:24,height:24,flavor:l.flavor})," ",t.jsx("span",{children:l.value})]})})},l.value))})]})]})}function Jt(){const e=W({resolver:$(Et),shouldUnregister:!0});return t.jsx(V,{...e,children:t.jsxs(T,{children:[t.jsx(I,{children:"Artifact Store"}),t.jsx(D,{children:t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsx(Mt,{}),t.jsx(Yt,{})]})}),t.jsx(E,{children:t.jsx(Xt,{})})]})})}function Xt(){const e=y();return t.jsx(w,{disabled:!e.formState.isValid,form:"artifact-store-form",size:"md",children:"Next"})}function er(e,r){const s=Object.keys(e).reduce((n,o)=>{var d,c;const i=e[o];let a;const u=Ye(o,r);switch(i.type||((c=(d=i.anyOf)==null?void 0:d.find(m=>m.type!==null))==null?void 0:c.type)){case"string":a=h.string().trim();break;case"boolean":a=h.boolean();break;case"array":a=h.array(h.string());break;default:a=h.string();break}return u&&(a=a.optional()),!u&&i.type==="string"&&a instanceof h.ZodString&&(a=a.min(1,"Required")),n[o]=a,n},{});return h.object(s)}function Ye(e,r){return!r.includes(e)}async function tr(e){const r=Y(J.serviceConnectors.types.detail(e)),s=await ve(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&Ee(),!s.ok){const n=await s.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>"Error while fetching service connector type");throw new X({status:s.status,statusText:s.statusText,message:n})}return s.json()}const Ne={connectorTypes:["service_connector_types"],serviceConnectorTypeDetail:e=>Le({queryKey:[...Ne.connectorTypes,e],queryFn:async()=>tr(e)})},Je=h.object({authMethod:h.string().min(1),stackName:St});function rr(){var c,m;const{data:e}=C(),{setCurrentStep:r}=P(),{control:s,watch:n,resetField:o}=y(),{setSchema:i}=re(),a=te({...Ne.serviceConnectorTypeDetail(((c=e.connectorConfig)==null?void 0:c.type)||"")});if(a.isError)return null;if(a.isPending)return t.jsx(ee,{className:"h-[40px] w-[100px]"});const u=a.data.auth_methods.filter(l=>l.auth_method!=="implicit").map(l=>({name:l.name,auth_method:l.auth_method}));if(!((m=e.connectorConfig)!=null&&m.type)){r(1);return}function f(){var Fe;const l=n("authMethod"),x=(Fe=a.data)==null?void 0:Fe.auth_methods.find(ae=>ae.auth_method===l);if(!x)return;const p=er(x.config_schema.properties,x.config_schema.required);i(Je.merge(p)),Object.keys(p.shape).forEach(ae=>o(ae))}const d=e.connectorConfig.type||"";return t.jsx(b,{control:s,name:"authMethod",render:({field:{onChange:l,ref:x,...p}})=>t.jsxs(nt,{...p,onValueChange:S=>{l(S),f()},children:[t.jsx(ot,{className:"w-fit border border-neutral-300 text-left text-text-md",children:t.jsx(it,{className:"flex items-center gap-2",placeholder:"Select your Auth Method"})}),t.jsx(at,{children:t.jsx(ct,{viewportClassName:"max-h-[300px]",children:u.map(S=>t.jsx(lt,{className:"space-x-2",value:S.auth_method,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(M,{provider:d}),t.jsx("div",{children:S.name})]})},S.auth_method))})})]})})}function sr(){return t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(bt,{className:"h-5 w-5 fill-primary-400"}),"Select an Authentication Method"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Connect ZenML to your resources for seamless integration of cloud services into your ML pipelines."})]}),t.jsx(rr,{})]})}function nr({schema:e,name:r,isOptional:s}){var o,i;const n=e.type||((i=(o=e.anyOf)==null?void 0:o.find(a=>a.type!==null))==null?void 0:i.type);if(!n)return null;switch(n){case"string":return t.jsx(or,{isOptional:s,schema:e,name:r});case"array":return t.jsx(ir,{isOptional:s,schema:e,name:r});case"boolean":return t.jsx(ar,{isOptional:s,schema:e,name:r});default:return null}}function or({name:e,schema:r,isOptional:s}){const n=y(),o=r.format==="password";return t.jsxs("div",{children:[t.jsxs("label",{htmlFor:e,className:"text-text-sm",children:[r.title," ",s?"(optional)":""]}),t.jsx(b,{defaultValue:"",control:n.control,name:e,render:({field:i})=>t.jsx(B,{inputSize:"md",className:"w-full",id:e,...i,type:o?"password":"text"})})]})}function ir({name:e,schema:r,isOptional:s}){const{control:n}=y(),{fields:o,append:i,remove:a}=vt({name:e,control:n});return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"text-text-sm",children:[r.title," ",s?"(optional)":""]}),t.jsx("ul",{className:"space-y-5",children:o.map((u,f)=>t.jsxs("li",{className:"flex w-full items-center gap-4 [&>div]:w-full",children:[t.jsx(b,{defaultValue:"",name:`${e}.${f}`,render:({field:d})=>t.jsx(B,{className:"w-full flex-1",inputSize:"md",...d})}),t.jsxs(w,{className:"h-7 w-7",emphasis:"subtle",size:"sm",type:"button",onClick:()=>a(f),children:[t.jsx(Pt,{className:"h-5 w-5 fill-primary-900"}),t.jsx("span",{className:"sr-only",children:"remove"})]})]},u.id))}),t.jsxs(w,{className:"h-7 w-7",emphasis:"subtle",type:"button",onClick:()=>i(""),children:[t.jsx(kt,{className:"h-5 w-5 fill-primary-900"}),t.jsx("p",{className:"sr-only",children:"Add Item"})]})]})}function ar({name:e,schema:r,isOptional:s}){const n=y(),o=r.default||!1;return t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("label",{htmlFor:e,className:"text-text-sm",children:[r.title," ",s?"(optional)":""]}),t.jsx(b,{defaultValue:o,control:n.control,name:e,render:({field:{onChange:i,value:a,...u}})=>t.jsx(ut,{id:e,checked:a,onCheckedChange:f=>i(f),...u})})]})}function cr(){return t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(Ft,{className:"h-5 w-5 fill-primary-400"}),"Add your Configuration"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Your credentials are securely stored and encrypted. ZenML uses these credentials to interact with your resources."})]}),t.jsx(lr,{})]})}function lr(){var f,d;const{data:e}=C(),{watch:r}=y(),s=te({...Ne.serviceConnectorTypeDetail(((f=e.connectorConfig)==null?void 0:f.type)||"")}),n=r("authMethod"),o=(d=s.data)==null?void 0:d.auth_methods.find(c=>c.auth_method===n);if(s.isError)return null;if(s.isPending)return t.jsx(ee,{className:"h-[200px] w-full"});if(!o)return null;const i=o.config_schema.properties,a=o.config_schema.required,u=Object.entries(i).sort(([c],[m])=>a.includes(c)&&!a.includes(m)?-1:!a.includes(c)&&a.includes(m)?1:0);return t.jsx("div",{className:"space-y-5",children:u.map(([c,m])=>t.jsx(nr,{isOptional:Ye(c,a),name:c,schema:m},c))})}function ur({open:e,loadingComponents:r}){var n,o;const{data:s}=C();return(n=s.connectorConfig)!=null&&n.type?t.jsx(dt,{open:e,children:t.jsxs(ft,{onPointerDownOutside:i=>i.preventDefault(),onEscapeKeyDown:i=>i.preventDefault(),className:"max-w-[600px]",children:[t.jsx("div",{className:"flex items-center justify-between border-b border-theme-border-moderate py-2 pl-5 pr-3",children:t.jsx(mt,{className:"text-text-lg",children:"Connecting and loading your components..."})}),t.jsxs("div",{className:"flex h-[200px] items-center justify-center gap-5 bg-primary-50",children:[t.jsx(ht,{className:"h-[60px] w-[60px]"}),t.jsx("div",{className:"flex h-[60px] w-[60px] items-center justify-center",children:t.jsx(At,{className:"h-5 w-5 fill-theme-text-tertiary"})}),t.jsx(M,{className:"h-[60px] w-[60px]",provider:s.connectorConfig.type})]}),t.jsxs("div",{className:"flex flex-col gap-1 px-7 pb-6 pt-5",children:[t.jsxs("p",{className:"text-theme-text-secondary",children:["We're securely connecting to"," ",t.jsx("span",{className:"capitalize",children:(o=s.connectorConfig)==null?void 0:o.type})," and retrieving your custom components. This process typically takes about 30-60 seconds."]}),t.jsx(dr,{loadingComponents:r})]})]})}):null}function dr({loadingComponents:e}){const[r,s]=_.useState(!0),[n,o]=_.useState(!0);return _.useEffect(()=>{const i=setTimeout(()=>{s(!1)},Math.floor(Math.random()*1e3)+500),a=setTimeout(()=>{o(!1)},1500);return()=>{clearTimeout(i),clearTimeout(a)}},[]),t.jsxs("ul",{className:"mt-3 space-y-3 text-theme-text-secondary",children:[t.jsxs(me,{children:[t.jsx(fe,{loading:r}),"Establishing a secure connection"]}),t.jsxs(me,{children:[t.jsx(fe,{loading:n}),"Authenticating your account"]}),t.jsxs(me,{children:[t.jsx(fe,{loading:e}),"Fetching your existing components"]})]})}function fe({loading:e}){return e?t.jsx(xt,{className:"h-5 w-5 border-2"}):t.jsx(be,{className:"h-5 w-5",tickClasses:"w-3 h-3"})}function me({children:e}){return t.jsx("li",{className:"flex items-center gap-1",children:e})}async function fr({payload:e}){const r=Y(J.serviceConnectors.fullStackResources),s=await ve(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>"Error while fetching service connector type");throw new X({status:s.status,statusText:s.statusText,message:n})}return s.json()}function mr(e){return qe({...e,mutationFn:async({payload:r})=>fr({payload:r})})}function hr(e){return new Promise(r=>setTimeout(r,e))}function xr(){const{setCurrentStep:e}=P(),[r,s]=_.useState(!0),{toast:n}=Me(),{setData:o,data:i}=C(),a=mr({onSuccess:async f=>{o(d=>O(d,c=>{c.fullstackResources=f})),s(!1),await hr(200),e(d=>d+1)},onError:f=>{n({status:"error",emphasis:"subtle",description:f.message,rounded:!0})}});return{handleFormSubmit:({authMethod:f,stackName:d,...c})=>{Object.keys(c).forEach(l=>{(c[l]===""||c[l]===null||c[l]===void 0||Array.isArray(c[l])&&c[l].length===0)&&delete c[l]});const m=O(i,l=>{l.stackName=d,l.connectorConfig&&(l.connectorConfig.auth_method=f,l.connectorConfig.configuration={...c})});o(m),m.connectorConfig&&a.mutate({payload:m.connectorConfig})},fullStackResources:a,loadingComponents:r}}function pr(){const{handleSubmit:e,formState:{isSubmitting:r}}=y(),{handleFormSubmit:s,fullStackResources:n,loadingComponents:o}=xr();return t.jsxs("form",{onSubmit:e(s),id:"connect-form",children:[t.jsx(ur,{loadingComponents:o,open:r||n.isPending}),t.jsx(sr,{}),t.jsx(et,{}),t.jsx(cr,{})]})}function yr(){const{schema:e}=re(),r=W({shouldUnregister:!0,mode:"onChange",resolver:$(e)});return t.jsx(V,{...r,children:t.jsxs(T,{children:[t.jsx(I,{children:"Connect to your Cloud"}),t.jsx(D,{children:t.jsx(pr,{})}),t.jsx(E,{children:t.jsx(jr,{})})]})})}function jr(){const{formState:{isValid:e,isSubmitting:r}}=y(),s=!!Be();return t.jsx(w,{className:"justify-center gap-2",disabled:!e||s||r,form:"connect-form",size:"md",children:s||r?"Loading...":"Next"})}async function gr({workspaceId:e,payload:r}){const s=Y(J.workspaces.fullStack(e)),n=await fetch(s,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const o=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>"Error while creating full stack");throw new X({status:n.status,statusText:n.statusText,message:o})}return n.json()}function _r(e){return qe({...e,mutationFn:async({workspaceId:r,payload:s})=>gr({workspaceId:r,payload:s})})}function vr(){const{data:e,setData:r}=C(),s=Ct(),{toast:n}=Me(),{setCurrentStep:o}=P(),{mutate:i}=_r({onError:d=>{d instanceof Error&&n({status:"error",emphasis:"subtle",icon:t.jsx(pt,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:d.message,rounded:!0})},onSuccess:async d=>{r(c=>O(c,m=>{m.createdStackId=d.id})),o(c=>c+1),s.invalidateQueries({queryKey:Re.all})}});if(!e.fullstackResources)return o(2),{handleFormSubmit:()=>{},flattenedInstances:[]};const a=e.fullstackResources.components_resources_info.container_registry,u=a.flatMap(d=>d.accessible_by_service_connector.map(c=>({...d,value:c})));function f({flavor:d,resourceId:c}){const m=a.find(x=>x.flavor===d);if(!m)return;const l=O(e,x=>{x.registryConfig={flavor:d,configuration:Object.fromEntries(Object.keys(m.required_configuration||{}).map(p=>[p,c])),service_connector_resource_id:c}});r(l),i({workspaceId:"default",payload:{name:l.stackName||Math.random().toString(36).substring(7),service_connectors:l.connectorConfig?[l.connectorConfig]:[],components:{orchestrator:l.orchestratorConfig,artifact_store:l.artifactStoreConfig,container_registry:l.registryConfig}}})}return{handleFormSubmit:f,flattenedInstances:u}}const Sr="container_registry";function br(){const[e,r]=_.useState(""),{control:s,setValue:n,handleSubmit:o,register:i,watch:a,trigger:u,reset:f}=y(),{flattenedInstances:d,handleFormSubmit:c}=vr(),m=d.filter(l=>l.value.toLocaleLowerCase().includes(e.toLocaleLowerCase()));return t.jsxs(t.Fragment,{children:[t.jsx(B,{placeholder:"Search...",onChange:l=>{f(),r(l.target.value)}}),t.jsxs("form",{onSubmit:o(c),id:"artifact-store-form",children:[t.jsx("input",{type:"hidden",...i("flavor")}),t.jsx("ul",{className:"space-y-1",children:m.map(l=>t.jsx("li",{children:t.jsx(b,{name:"resourceId",control:s,render:({field:{onChange:x,...p}})=>t.jsxs(K,{"data-state":a("resourceId")===l.value?"selected":"unselected",htmlFor:l.value,children:[t.jsx(H,{id:l.value,type:"radio",...p,onChange:S=>{n("flavor",l.flavor,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),x(S.target.value),u()},value:l.value,name:"connector-radio"}),t.jsx(q,{width:24,height:24,type:Sr,flavor:l.flavor})," ",t.jsx("span",{children:l.value})]})})},l.value))})]})]})}function Cr(){return t.jsx("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(Se,{type:"container_registry",className:"h-5 w-5 fill-primary-400"}),"Select your Container Registry"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select one of the Container Registries for your new stack"})]})})}const wr=h.object({flavor:h.string().min(1),resourceId:h.string().min(1)});function Nr(){const e=W({resolver:$(wr),shouldUnregister:!0});return t.jsx(V,{...e,children:t.jsxs(T,{children:[t.jsx(I,{children:"Container Registry"}),t.jsx(D,{children:t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsx(Cr,{}),t.jsx(br,{})]})}),t.jsx(E,{children:t.jsx(Fr,{})})]})})}function Fr(){const e=y(),r=!!Be();return t.jsxs(w,{className:"justify-center gap-2",disabled:!e.formState.isValid||r,form:"artifact-store-form",size:"md",children:[r&&t.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),r?"Loading...":"Next"]})}function kr(){var i;const{data:e,setData:r}=C(),{setCurrentStep:s}=P();if(!e.fullstackResources)return s(2),{orchestrators:[],handleFormSubmit:()=>{}};const n=((i=e.fullstackResources.components_resources_info)==null?void 0:i.orchestrator)||[];function o({flavor:a,resourceId:u,...f}){const d=n.find(c=>c.flavor===a);d&&(r(c=>{const m=d!=null&&d.use_resource_value_as_fixed_config?Object.fromEntries(Object.keys(d.required_configuration||{}).map(l=>[l,u])):{...f};return O(c,l=>{l.orchestratorConfig={flavor:a,configuration:m,service_connector_resource_id:u}})}),s(c=>c+1))}return{orchestrators:n,handleFormSubmit:o}}const _e=h.object({flavor:h.string().min(1),resourceId:h.string().min(1)});function Pr(e){const r=Object.keys(e).reduce((s,n)=>(s[n]=h.string().trim().min(1),s),{});return h.object(r)}const Z="kubernetes",Ie="orchestrator";function Ar(){const{orchestrators:e,handleFormSubmit:r}=kr(),{setSchema:s}=re(),{control:n,watch:o,setValue:i,register:a,reset:u,handleSubmit:f}=y(),d=o("flavor");return t.jsxs("form",{onSubmit:f(r),id:"artifact-store-form",children:[d!==Z&&t.jsx("input",{...a("resourceId"),type:"hidden"}),t.jsx("ul",{className:"space-y-1",children:e.map((c,m)=>t.jsxs("li",{children:[t.jsx(b,{control:n,name:"flavor",render:({field:{onChange:l,...x}})=>t.jsxs(K,{"data-state":d===c.flavor?"selected":"unselected",htmlFor:c.flavor,children:[t.jsx(H,{onChange:p=>{u({flavor:c.flavor}),c.use_resource_value_as_fixed_config===!0&&s(_e),c.use_resource_value_as_fixed_config===!1&&c.required_configuration&&s(_e.merge(Pr(c.required_configuration))),c.flavor!==Z&&c.accessible_by_service_connector.length>0&&i("resourceId",c.accessible_by_service_connector[0]),l(p)},...x,id:c.flavor,type:"radio",value:c.flavor,name:"orchestrator-flavor-radio"}),t.jsx(q,{width:24,height:24,type:Ie,flavor:c.flavor}),t.jsx("span",{children:c.flavor_display_name})]})}),d===c.flavor&&(c.flavor===Z||c.use_resource_value_as_fixed_config===!1)&&t.jsxs("div",{className:"space-y-3 py-5 pl-8",children:[c.flavor===Z&&t.jsx("ul",{className:"space-y-1",children:c.accessible_by_service_connector.map(l=>t.jsx("li",{children:t.jsx(b,{control:n,name:"resourceId",render:({field:x})=>t.jsxs(K,{"data-state":o("resourceId")===l?"selected":"unselected",htmlFor:l,children:[t.jsx(H,{...x,id:l,type:"radio",value:l,name:"instance-radio"}),t.jsx(q,{type:Ie,width:24,height:24,flavor:c.flavor}),t.jsx("span",{children:l})]})})},l))}),c.use_resource_value_as_fixed_config===!1&&c.required_configuration&&Object.keys(c.required_configuration).length>=1&&t.jsx("div",{children:Object.entries(c.required_configuration).map(([l,x])=>t.jsx("div",{children:t.jsx(b,{name:l,control:n,render:({field:p})=>t.jsxs("div",{children:[t.jsx("label",{htmlFor:l,className:"text-text-sm",children:x}),t.jsx(B,{...p,inputSize:"md",required:!0,className:"w-full",id:l})]})})},l))})]})]},m))})]})}function zr(){return t.jsx("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(Se,{type:"orchestrator",className:"h-5 w-5 fill-primary-400"}),"Select your Orchestrator"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select one of the connected orchestrators for your new stack"})]})})}function Or(){const{schema:e}=re(),r=W({resolver:$(e),shouldUnregister:!0,defaultValues:{resourceId:""}});return t.jsx(V,{...r,children:t.jsxs(T,{children:[t.jsx(I,{children:"Orchestrator"}),t.jsxs(D,{children:[t.jsx(zr,{}),t.jsx(Ar,{})]}),t.jsx(E,{children:t.jsx(Tr,{})})]})})}function Tr(){const e=y();return t.jsx(w,{disabled:!e.formState.isValid,form:"artifact-store-form",size:"md",children:"Next"})}const Ir=h.object({provider:h.string().min(1)});function Dr(){var i;const{setData:e,data:r}=C(),{setCurrentStep:s}=P(),n=W({resolver:$(Ir),defaultValues:{provider:((i=r.connectorConfig)==null?void 0:i.type)||""}});function o(a){e(u=>({...u,connectorConfig:{type:a.provider,auth_method:""}})),s(u=>u+1)}return t.jsx(V,{...n,children:t.jsxs(T,{children:[t.jsx(I,{children:"Select Your Existing Cloud Infrastructure"}),t.jsx(D,{children:t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-text-lg font-semibold",children:"Select a Cloud Provider"}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select the cloud provider where you have existing infrastructure to connect with ZenML. This will allow you to integrate your current cloud resources with ZenML for model deployment and management."})]}),t.jsxs("form",{id:"provider-form",onSubmit:n.handleSubmit(o),className:"grid grid-cols-1 gap-3 xl:grid-cols-3",children:[t.jsx(ce,{id:"aws-provider",...n.register("provider"),value:"aws",children:t.jsx(le,{icon:t.jsx(M,{provider:"aws",className:"h-6 w-6 shrink-0"}),title:"AWS",subtitle:"Connect your existing S3, ECR, and Sagemaker components to ZenML"})}),t.jsx(ce,{id:"gcp-provider",...n.register("provider"),value:"gcp",children:t.jsx(le,{icon:t.jsx(M,{provider:"gcp",className:"h-6 w-6 shrink-0"}),title:"GCP",subtitle:"Link your GCS, Artifact Registry, and Vertex AI components to ZenML"})}),t.jsx(ce,{id:"azure-provider",...n.register("provider"),value:"azure",children:t.jsx(le,{icon:t.jsx(M,{provider:"azure",className:"h-6 w-6 shrink-0"}),title:"Azure",subtitle:"Integrate ZenML with your Blob Storage, Container Registry, and Azure ML"})})]})]})}),t.jsx(E,{children:t.jsx(Er,{})})]})})}function Er(){const{formState:{isValid:e}}=y();return t.jsx(w,{form:"provider-form",disabled:!e,size:"md",children:"Next"})}function Mr(){var o;const{data:e}=C(),r=te({...Re.stackDetail(e.createdStackId||""),throwOnError:!0});if(r.isError)return null;if(r.isPending)return t.jsx(ee,{className:"h-[200px] w-full"});const s=r.data,n=Ot((o=r.data.metadata)==null?void 0:o.components);return t.jsxs(T,{children:[t.jsx(I,{children:"Your stack"}),t.jsx(D,{children:t.jsxs("div",{className:"space-y-5",children:[t.jsx("p",{className:"text-theme-text-secondary",children:"Here you can review the created stack and stack components. Now you can start running pipelines using this new configuration."}),t.jsxs("div",{className:"divide-y divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[t.jsx(Lr,{stack:s}),n.map(i=>t.jsx(qr,{component:i},i.id))]})]})}),t.jsx(E,{displayCancel:!1,children:t.jsx(Rr,{})})]})}function Rr(){return t.jsx(w,{size:"md",asChild:!0,children:t.jsx(Tt,{to:yt.stacks.overview,children:"Finish"})})}function Lr({stack:e}){return t.jsxs("div",{className:"flex items-center gap-3 bg-theme-surface-secondary p-5 font-semibold",children:[t.jsx(be,{className:"h-5 w-5",tickClasses:"w-3 h-3"}),t.jsx(jt,{type:"square",size:"lg",children:t.jsx(gt,{size:"lg",children:e.name[0]})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-text-lg",children:e.name}),t.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.id.split("-")[0]})]})]})}function qr({component:e}){var r,s,n,o;return t.jsxs("div",{className:"flex items-center justify-between py-3 pl-9 pr-5",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(be,{className:"h-5 w-5",tickClasses:"w-3 h-3"}),t.jsx(q,{width:24,height:24,flavor:((r=e.body)==null?void 0:r.flavor)||"",type:((s=e.body)==null?void 0:s.type)||"orchestrator"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-text-lg font-semibold",children:e.name}),t.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.id.split("-")[0]})]})]}),t.jsx(zt,{type:((n=e.body)==null?void 0:n.type)||"alerter",children:_t((o=e.body)==null?void 0:o.type)})]},e.id)}function Br(){const{currentStep:e}=P();if(e===1)return t.jsx(Dr,{});if(e===2)return t.jsx(ke,{initialSchema:Je,children:t.jsx(yr,{})});if(e===3)return t.jsx(Jt,{});if(e===4)return t.jsx(ke,{initialSchema:_e,children:t.jsx(Or,{})});if(e===5)return t.jsx(Nr,{});if(e===6)return t.jsx(Mr,{})}const De=["Infrastructure Type","Cloud Provider","Connect your Cloud","Artifact Store","Orchestrator","Container Registry"];function us(){return t.jsx(tt,{maxSteps:De.length+1,initialStep:1,children:t.jsx(It,{children:t.jsxs("section",{className:"layout-container flex flex-col gap-5 py-5 xl:flex-row",children:[t.jsx(rt,{entries:De}),t.jsx("div",{className:"w-full",children:t.jsx(Br,{})})]})})})}export{us as default};
